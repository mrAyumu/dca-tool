<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decline Curve Analysis Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-panel {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            padding: 30px;
            min-height: 500px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .upload-section {
            border: 3px dashed #dee2e6;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .upload-section.dragover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .upload-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 10px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .file-list {
            margin-top: 20px;
            text-align: left;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .file-info {
            display: flex;
            align-items: center;
        }

        .file-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            background: #667eea;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .remove-file {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .data-preview {
            margin-top: 30px;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .preview-table th,
        .preview-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .preview-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .outlier-options {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .outlier-options h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"] {
            accent-color: #667eea;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .analyze-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .results-section {
            margin-top: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }

        .download-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .download-btn {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.3s ease;
        }

        .download-btn:hover {
            transform: translateY(-2px);
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
            display: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Decline Curve Analysis Tool</h1>
            <p>An intelligent petroleum engineering tool that eliminates manual decline curve analysis 
                guesswork for field-scale production data. Automatically selects optimal decline models 
                for each well and provides actionable insights for production forecasting.</p>
        </div>

        <div class="main-panel">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('upload')">1. Upload Data</button>
                <button class="nav-tab" onclick="switchTab('preview')">2. Preview & Configure</button>
                <button class="nav-tab" onclick="switchTab('analyze')">3. Run Analysis</button>
                <button class="nav-tab" onclick="switchTab('results')">4. View Results</button>
            </div>

            <div class="tab-content">
                <!-- Upload Tab -->
                <div id="upload-tab" class="tab-panel active">
                    <div class="upload-section" id="upload-area">
                        <h3>📂 Upload Production Data Files</h3>
                        <p>Drag and drop your CSV files here, or click to browse</p>
                        <input type="file" id="file-input" class="file-input" multiple accept=".csv" onchange="handleFileSelect(event)">
                        <button class="upload-btn" onclick="document.getElementById('file-input').click()">
                            Choose Files
                        </button>
                        <p style="margin-top: 15px; color: #6c757d; font-size: 0.9rem;">
                            Supports multiple CSV files. Expected columns: UWI, Month, Avg Dly Oil (m3/d)
                        </p>
                    </div>

                    <div class="file-list" id="file-list"></div>

                    <div class="error-message" id="upload-error"></div>
                    <div class="success-message" id="upload-success"></div>
                </div>

                <!-- Preview Tab -->
                <div id="preview-tab" class="tab-panel">
                    <h3>Data Preview & Configuration</h3>
                    
                    <div class="data-preview" id="data-preview">
                        <p>Upload files to see data preview...</p>
                    </div>

                    <div class="outlier-options">
                        <h4>Outlier Handling Options</h4>
                        <p>Choose how to handle outliers in production data:</p>
                        
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="outlier-remove" name="outlier-method" value="remove" checked>
                                <label for="outlier-remove">Remove outliers</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="outlier-flag" name="outlier-method" value="flag">
                                <label for="outlier-flag">Flag outliers (keep in dataset)</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="outlier-replace" name="outlier-method" value="replace">
                                <label for="outlier-replace">Replace with mean/median</label>
                            </div>
                        </div>

                        <div id="replacement-options" style="display: none; margin-top: 15px;">
                            <label>Replace outliers with:</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="replace-mean" name="replacement-method" value="mean" checked>
                                    <label for="replace-mean">Mean</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="replace-median" name="replacement-method" value="median">
                                    <label for="replace-median">Median</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analyze Tab -->
                <div id="analyze-tab" class="tab-panel">
                    <h3>Run Decline Curve Analysis</h3>
                    
                    <div style="margin: 20px 0;">
                        <label>
                            <input type="checkbox" id="multi-wave-analysis" checked> 
                            Enable Multi-Wave Analysis (improves fits for wells with poor R² scores)
                        </label>
                    </div>

                    <div id="multi-wave-options" style="margin: 20px 0;">
                        <label for="r2-threshold">R² Threshold for Multi-Wave Analysis:</label>
                        <input type="number" id="r2-threshold" value="0.75" min="0" max="1" step="0.01" style="margin-left: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>

                    <button class="analyze-btn" id="analyze-button" onclick="runAnalysis()" disabled>
                        🚀 Start Analysis
                    </button>

                    <div class="progress-bar" id="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>

                    <div id="analysis-status" style="margin: 20px 0; color: #6c757d;"></div>
                </div>

                <!-- Results Tab -->
                <div id="results-tab" class="tab-panel">
                    <h3>Analysis Results</h3>
                    
                    <div class="stats-grid" id="stats-grid">
                        <!-- Statistics will be populated here -->
                    </div>

                    <div class="chart-container" id="chart-container">
                        <p>Run analysis to view results...</p>
                    </div>

                    <div class="download-section" id="download-section" style="display: none;">
                        <h4>Download Results</h4>
                        <button class="download-btn" onclick="downloadFile('constants')">
                            📊 Decline Constants
                        </button>
                        <button class="download-btn" onclick="downloadFile('detailed')">
                            📈 Detailed Results
                        </button>
                        <button class="download-btn" onclick="downloadFile('summary')">
                            📋 Analysis Summary
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let uploadedFiles = [];
        let analysisResults = null;
        const API_BASE_URL = 'https://your-api-url.com'; // We'll update this when we deploy the API

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and panels
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            
            // Add active class to selected tab and panel
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update analyze button state
            updateAnalyzeButton();
        }

        // File upload handling
        function setupFileUpload() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');

            // Drag and drop handlers
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            // Outlier method change handler
            document.querySelectorAll('input[name="outlier-method"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const replacementOptions = document.getElementById('replacement-options');
                    if (e.target.value === 'replace') {
                        replacementOptions.style.display = 'block';
                    } else {
                        replacementOptions.style.display = 'none';
                    }
                });
            });

            // Multi-wave analysis toggle
            document.getElementById('multi-wave-analysis').addEventListener('change', (e) => {
                const options = document.getElementById('multi-wave-options');
                options.style.display = e.target.checked ? 'block' : 'none';
            });
        }

        function handleFileSelect(event) {
            handleFiles(event.target.files);
        }

        function handleFiles(files) {
            const fileList = Array.from(files).filter(file => file.name.endsWith('.csv'));
            
            if (fileList.length === 0) {
                showError('Please select CSV files only.');
                return;
            }

            uploadedFiles = [...uploadedFiles, ...fileList];
            displayFileList();
            showSuccess(`${fileList.length} file(s) added successfully.`);
            updateAnalyzeButton();
        }

        function displayFileList() {
            const fileListElement = document.getElementById('file-list');
            
            if (uploadedFiles.length === 0) {
                fileListElement.innerHTML = '';
                return;
            }

            const html = uploadedFiles.map((file, index) => `
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-icon">📄</div>
                        <div>
                            <div style="font-weight: 600;">${file.name}</div>
                            <div style="font-size: 0.8rem; color: #6c757d;">${(file.size / 1024).toFixed(1)} KB</div>
                        </div>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">Remove</button>
                </div>
            `).join('');

            fileListElement.innerHTML = html;
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            displayFileList();
            updateAnalyzeButton();
        }

        function updateAnalyzeButton() {
            const button = document.getElementById('analyze-button');
            button.disabled = uploadedFiles.length === 0;
        }

        // Message display functions
        function showError(message) {
            const errorDiv = document.getElementById('upload-error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('upload-success');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 3000);
        }

        // Analysis functions
        async function runAnalysis() {
            if (uploadedFiles.length === 0) {
                showError('Please upload CSV files first.');
                return;
            }

            const analyzeButton = document.getElementById('analyze-button');
            const progressBar = document.getElementById('progress-bar');
            const progressFill = document.getElementById('progress-fill');
            const statusDiv = document.getElementById('analysis-status');

            // Disable button and show progress
            analyzeButton.disabled = true;
            analyzeButton.textContent = '⏳ Analyzing...';
            progressBar.style.display = 'block';
            statusDiv.textContent = 'Preparing data for analysis...';

            try {
                // Prepare form data
                const formData = new FormData();
                uploadedFiles.forEach(file => formData.append('files', file));
                
                // Add configuration
                const outlierMethod = document.querySelector('input[name="outlier-method"]:checked').value;
                const replacementMethod = document.querySelector('input[name="replacement-method"]:checked')?.value || 'mean';
                const multiWave = document.getElementById('multi-wave-analysis').checked;
                const r2Threshold = document.getElementById('r2-threshold').value;

                formData.append('outlier_method', outlierMethod);
                formData.append('replacement_method', replacementMethod);
                formData.append('multi_wave', multiWave);
                formData.append('r2_threshold', r2Threshold);

                // Simulate progress updates (replace with real API call)
                await simulateAnalysis(progressFill, statusDiv);

                // For now, simulate successful results
                analysisResults = generateMockResults();
                displayResults();
                
                // Switch to results tab
                switchTab('results');

            } catch (error) {
                showError('Analysis failed: ' + error.message);
            } finally {
                // Reset button
                analyzeButton.disabled = false;
                analyzeButton.textContent = '🚀 Start Analysis';
                progressBar.style.display = 'none';
                statusDiv.textContent = '';
            }
        }

        async function simulateAnalysis(progressFill, statusDiv) {
            const steps = [
                { progress: 10, message: 'Uploading files...' },
                { progress: 25, message: 'Merging production data...' },
                { progress: 40, message: 'Handling outliers...' },
                { progress: 55, message: 'Normalizing time data...' },
                { progress: 70, message: 'Fitting decline models...' },
                { progress: 85, message: 'Running multi-wave analysis...' },
                { progress: 100, message: 'Analysis complete!' }
            ];

            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 800));
                progressFill.style.width = step.progress + '%';
                statusDiv.textContent = step.message;
            }
        }

        function generateMockResults() {
            // Mock results for demonstration
            return {
                summary: {
                    total_wells: 245,
                    avg_r2: 0.823,
                    exponential_count: 89,
                    hyperbolic_count: 132,
                    harmonic_count: 24
                },
                wells: Array.from({length: 10}, (_, i) => ({
                    uwi: `WELL_${i + 1}`,
                    model_type: ['exponential', 'hyperbolic', 'harmonic'][Math.floor(Math.random() * 3)],
                    r_squared: 0.6 + Math.random() * 0.4,
                    initial_rate: 50 + Math.random() * 100,
                    decline_rate: 0.05 + Math.random() * 0.1
                }))
            };
        }

        function displayResults() {
            if (!analysisResults) return;

            const statsGrid = document.getElementById('stats-grid');
            const downloadSection = document.getElementById('download-section');

            // Display summary statistics
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${analysisResults.summary.total_wells}</div>
                    <div class="stat-label">Total Wells Analyzed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${analysisResults.summary.avg_r2.toFixed(3)}</div>
                    <div class="stat-label">Average R² Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${analysisResults.summary.exponential_count}</div>
                    <div class="stat-label">Exponential Models</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${analysisResults.summary.hyperbolic_count}</div>
                    <div class="stat-label">Hyperbolic Models</div>
                </div>
            `;

            // Show download section
            downloadSection.style.display = 'block';

            // Update chart (placeholder for now)
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = `
                <div style="text-align: center;">
                    <h4>Model Distribution</h4>
                    <p>Exponential: ${analysisResults.summary.exponential_count} wells</p>
                    <p>Hyperbolic: ${analysisResults.summary.hyperbolic_count} wells</p>
                    <p>Harmonic: ${analysisResults.summary.harmonic_count} wells</p>
                    <br>
                    <p style="color: #6c757d; font-style: italic;">Interactive charts will be available in the next update</p>
                </div>
            `;
        }

        function downloadFile(type) {
            // Placeholder for download functionality
            alert(`Download ${type} file - This will be implemented with the API backend`);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupFileUpload();
        });
    </script>
</body>
</html>